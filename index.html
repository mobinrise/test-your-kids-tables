<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplication Master - Kids Math Quiz</title>
    <meta property="og:title" content="Multiplication Master - Fun Math Quiz for Kids">
    <meta property="og:description" content="Test your multiplication tables from 2-10 with timed quizzes! Mixed mode and practice mode available.">
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function MultiplicationQuiz() {
            const [gameMode, setGameMode] = useState('menu');
            const [selectedMode, setSelectedMode] = useState('mixed');
            const [selectedTable, setSelectedTable] = useState(2);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [score, setScore] = useState(0);
            const [questions, setQuestions] = useState([]);
            const [userAnswer, setUserAnswer] = useState('');
            const [timeLeft, setTimeLeft] = useState(10);
            const [totalQuestions] = useState(10);
            const [streak, setStreak] = useState(0);
            const [bestStreak, setBestStreak] = useState(0);
            const [feedback, setFeedback] = useState('');
            const timerRef = useRef(null);
            const inputRef = useRef(null);

            useEffect(() => {
                if (gameMode === 'playing' && timeLeft > 0 && feedback === '') {
                    timerRef.current = setTimeout(() => {
                        setTimeLeft(timeLeft - 1);
                    }, 1000);
                } else if (gameMode === 'playing' && timeLeft === 0 && feedback === '') {
                    handleTimeout();
                }

                return () => {
                    if (timerRef.current) {
                        clearTimeout(timerRef.current);
                    }
                };
            }, [timeLeft, gameMode, feedback]);

            const generateQuestions = (mode, table) => {
                const newQuestions = [];
                const usedCombinations = new Set();
                
                if (mode === 'mixed') {
                    while (newQuestions.length < totalQuestions) {
                        const table = Math.floor(Math.random() * 9) + 2;
                        const multiplier = Math.floor(Math.random() * 10) + 1;
                        const key = `${table}-${multiplier}`;
                        
                        // Check if this combination was used in last question
                        if (newQuestions.length > 0) {
                            const lastQ = newQuestions[newQuestions.length - 1];
                            if (lastQ.table === table && lastQ.multiplier === multiplier) {
                                continue; // Skip duplicate
                            }
                        }
                        
                        if (!usedCombinations.has(key)) {
                            usedCombinations.add(key);
                            newQuestions.push({
                                table,
                                multiplier,
                                answer: table * multiplier
                            });
                        }
                    }
                } else {
                    const multipliers = [];
                    while (multipliers.length < totalQuestions) {
                        const multiplier = Math.floor(Math.random() * 10) + 1;
                        if (multipliers.length === 0 || multipliers[multipliers.length - 1] !== multiplier) {
                            if (!multipliers.includes(multiplier) || multipliers.length > 5) {
                                multipliers.push(multiplier);
                            }
                        }
                    }
                    
                    multipliers.forEach(multiplier => {
                        newQuestions.push({
                            table,
                            multiplier,
                            answer: table * multiplier
                        });
                    });
                }
                
                return newQuestions;
            };

            const startGame = (mode, table = 2) => {
                const newQuestions = generateQuestions(mode, table);
                setQuestions(newQuestions);
                setGameMode('playing');
                setCurrentQuestion(0);
                setScore(0);
                setStreak(0);
                setUserAnswer('');
                setTimeLeft(10);
                setFeedback('');
                setTimeout(() => inputRef.current?.focus(), 100);
            };

            const goToMainMenu = () => {
                if (window.confirm('Are you sure you want to go back to main menu? Your progress will be lost.')) {
                    setGameMode('menu');
                    setScore(0);
                    setStreak(0);
                    setCurrentQuestion(0);
                    setFeedback('');
                }
            };

            const playSound = (type) => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                if (type === 'correct') {
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.2;
                } else if (type === 'wrong') {
                    oscillator.frequency.value = 200;
                    gainNode.gain.value = 0.2;
                } else if (type === 'complete') {
                    oscillator.frequency.value = 1000;
                    gainNode.gain.value = 0.3;
                }
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
            };

            const handleSubmit = () => {
                if (!userAnswer || feedback !== '') return;
                
                const answer = parseInt(userAnswer);
                const correct = answer === questions[currentQuestion].answer;
                
                if (correct) {
                    playSound('correct');
                    setScore(score + 1);
                    setStreak(streak + 1);
                    if (streak + 1 > bestStreak) setBestStreak(streak + 1);
                    setFeedback('correct');
                    
                    // Auto-advance after 1.5 seconds for correct answer
                    setTimeout(() => {
                        moveToNextQuestion();
                    }, 1500);
                } else {
                    playSound('wrong');
                    setStreak(0);
                    setFeedback('wrong');
                    // Don't auto-advance for wrong answers - wait for user to click
                }
            };

            const moveToNextQuestion = () => {
                if (currentQuestion < totalQuestions - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                    setUserAnswer('');
                    setTimeLeft(10);
                    setFeedback('');
                    setTimeout(() => inputRef.current?.focus(), 100);
                } else {
                    playSound('complete');
                    setGameMode('results');
                }
            };

            const handleTimeout = () => {
                playSound('wrong');
                setStreak(0);
                setFeedback('timeout');
                // Don't auto-advance for timeout - wait for user to click
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && userAnswer && feedback === '') {
                    handleSubmit();
                }
            };

            const getScoreEmoji = () => {
                const percentage = (score / totalQuestions) * 100;
                if (percentage === 100) return 'üèÜ';
                if (percentage >= 80) return '‚≠ê';
                if (percentage >= 60) return 'üëç';
                if (percentage >= 40) return 'üòä';
                return 'üí™';
            };

            if (gameMode === 'menu') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-500 via-pink-500 to-orange-500 p-4 flex items-center justify-center">
                        <div className="max-w-4xl w-full">
                            <div className="bg-white rounded-3xl shadow-2xl p-8 text-center">
                                <div className="text-6xl mb-4 animate-bounce">üéØ</div>
                                <h1 className="text-5xl font-bold text-gray-800 mb-2">Multiplication Master!</h1>
                                <p className="text-xl text-gray-600 mb-8">Test your multiplication tables skills!</p>
                                
                                <div className="grid md:grid-cols-2 gap-6 mb-8">
                                    <div 
                                        onClick={() => {
                                            setSelectedMode('mixed');
                                            startGame('mixed');
                                        }}
                                        className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl p-8 cursor-pointer hover:scale-105 transition-all transform shadow-xl"
                                    >
                                        <div className="text-6xl mb-4">üé≤</div>
                                        <h2 className="text-3xl font-bold text-white mb-3">Mixed Tables</h2>
                                        <p className="text-white/90 text-lg mb-4">Random questions from 2 to 10 tables</p>
                                        <div className="bg-white/20 rounded-lg p-3 text-white">
                                            <p className="font-semibold">‚è±Ô∏è 10 seconds per question</p>
                                            <p className="font-semibold">‚ùì 10 questions</p>
                                        </div>
                                        <button className="mt-4 px-8 py-3 bg-white text-purple-600 rounded-xl font-bold text-lg hover:bg-gray-100 transition-all">
                                            Start Mixed Mode
                                        </button>
                                    </div>

                                    <div className="bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl p-8 shadow-xl">
                                        <div className="text-6xl mb-4">üìö</div>
                                        <h2 className="text-3xl font-bold text-white mb-3">Practice One Table</h2>
                                        <p className="text-white/90 text-lg mb-4">Choose a specific table to practice</p>
                                        <div className="bg-white/20 rounded-lg p-3 text-white mb-4">
                                            <p className="font-semibold">‚è±Ô∏è 10 seconds per question</p>
                                            <p className="font-semibold">‚ùì 10 questions</p>
                                        </div>
                                        
                                        <select
                                            value={selectedTable}
                                            onChange={(e) => setSelectedTable(parseInt(e.target.value))}
                                            className="w-full px-4 py-3 rounded-xl text-gray-800 font-bold text-lg mb-4 focus:outline-none focus:ring-4 focus:ring-white/50"
                                        >
                                            {[2, 3, 4, 5, 6, 7, 8, 9, 10].map(num => (
                                                <option key={num} value={num}>Table of {num}</option>
                                            ))}
                                        </select>
                                        
                                        <button
                                            onClick={() => {
                                                setSelectedMode('separate');
                                                startGame('separate', selectedTable);
                                            }}
                                            className="w-full px-8 py-3 bg-white text-green-600 rounded-xl font-bold text-lg hover:bg-gray-100 transition-all"
                                        >
                                            Start Practice
                                        </button>
                                    </div>
                                </div>

                                {bestStreak > 0 && (
                                    <div className="bg-yellow-100 border-2 border-yellow-400 rounded-2xl p-4">
                                        <p className="text-yellow-800 font-bold text-lg">
                                            üî• Best Streak: {bestStreak} correct answers in a row!
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameMode === 'playing' && questions.length > 0) {
                const question = questions[currentQuestion];
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 p-4 flex items-center justify-center">
                        <div className="max-w-2xl w-full">
                            <div className="bg-white rounded-3xl shadow-2xl p-8">
                                {/* Header with Main Menu Button */}
                                <div className="flex justify-between items-center mb-8">
                                    <div className="text-lg font-bold text-gray-700">
                                        Question {currentQuestion + 1}/{totalQuestions}
                                    </div>
                                    <div className="flex gap-4 items-center">
                                        {streak > 0 && (
                                            <div className="bg-orange-100 px-4 py-2 rounded-lg">
                                                <span className="text-orange-600 font-bold">üî• {streak} Streak!</span>
                                            </div>
                                        )}
                                        <div className="text-2xl font-bold text-gray-700">
                                            ‚≠ê {score}
                                        </div>
                                        <button
                                            onClick={goToMainMenu}
                                            className="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition-all"
                                        >
                                            üè† Menu
                                        </button>
                                    </div>
                                </div>

                                {/* Timer */}
                                <div className="mb-8">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-gray-600 font-semibold">Time Left:</span>
                                        <span className={`text-2xl font-bold ${timeLeft <= 3 ? 'text-red-500 animate-pulse' : 'text-blue-600'}`}>
                                            ‚è±Ô∏è {timeLeft}s
                                        </span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-4">
                                        <div
                                            className={`h-4 rounded-full transition-all duration-1000 ${
                                                timeLeft <= 3 ? 'bg-red-500' : 'bg-blue-500'
                                            }`}
                                            style={{ width: `${(timeLeft / 10) * 100}%` }}
                                        ></div>
                                    </div>
                                </div>

                                {/* Question */}
                                <div className="bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl p-12 mb-8 text-center">
                                    <div className="text-7xl font-bold text-gray-800 mb-4">
                                        {question.table} √ó {question.multiplier} = ?
                                    </div>
                                    {selectedMode === 'separate' && (
                                        <div className="text-gray-600 text-lg">Table of {selectedTable}</div>
                                    )}
                                </div>

                                {/* Answer Input */}
                                <div className="mb-8">
                                    <input
                                        ref={inputRef}
                                        type="number"
                                        value={userAnswer}
                                        onChange={(e) => setUserAnswer(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                        placeholder="Type your answer..."
                                        disabled={feedback !== ''}
                                        className={`w-full px-8 py-6 text-4xl font-bold text-center rounded-2xl border-4 focus:outline-none focus:ring-4 ${
                                            feedback === 'correct' ? 'border-green-500 bg-green-50' :
                                            feedback === 'wrong' ? 'border-red-500 bg-red-50' :
                                            feedback === 'timeout' ? 'border-orange-500 bg-orange-50' :
                                            'border-blue-300 focus:border-blue-500'
                                        }`}
                                    />
                                    
                                    {feedback === 'correct' && (
                                        <div className="mt-4 text-center text-2xl font-bold text-green-600 animate-bounce">
                                            ‚úÖ Correct! Great job!
                                        </div>
                                    )}
                                    {feedback === 'wrong' && (
                                        <div className="mt-4 text-center">
                                            <div className="text-2xl font-bold text-red-600 mb-3">
                                                ‚ùå Wrong! The correct answer is {question.answer}
                                            </div>
                                            <button
                                                onClick={moveToNextQuestion}
                                                className="px-8 py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold text-xl rounded-xl transition-all"
                                            >
                                                Next Question ‚Üí
                                            </button>
                                        </div>
                                    )}
                                    {feedback === 'timeout' && (
                                        <div className="mt-4 text-center">
                                            <div className="text-2xl font-bold text-orange-600 mb-3">
                                                ‚è∞ Time's up! The correct answer is {question.answer}
                                            </div>
                                            <button
                                                onClick={moveToNextQuestion}
                                                className="px-8 py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold text-xl rounded-xl transition-all"
                                            >
                                                Next Question ‚Üí
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Submit Button */}
                                {feedback === '' && (
                                    <button
                                        onClick={handleSubmit}
                                        disabled={!userAnswer}
                                        className="w-full py-5 bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold text-2xl rounded-2xl transition-all disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105"
                                    >
                                        Submit Answer ‚ú®
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameMode === 'results') {
                const percentage = (score / totalQuestions) * 100;
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-500 via-blue-500 to-purple-500 p-4 flex items-center justify-center">
                        <div className="max-w-2xl w-full">
                            <div className="bg-white rounded-3xl shadow-2xl p-8 text-center">
                                <div className="text-8xl mb-6 animate-bounce">
                                    {getScoreEmoji()}
                                </div>
                                
                                <h2 className="text-5xl font-bold text-gray-800 mb-4">
                                    {percentage === 100 ? 'Perfect Score!' :
                                     percentage >= 80 ? 'Excellent Work!' :
                                     percentage >= 60 ? 'Good Job!' :
                                     percentage >= 40 ? 'Keep Practicing!' :
                                     'Nice Try!'}
                                </h2>
                                
                                <div className="text-7xl font-bold text-purple-600 mb-8">
                                    {score}/{totalQuestions}
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4 mb-8">
                                    <div className="bg-blue-100 rounded-2xl p-6">
                                        <div className="text-4xl mb-2">üìä</div>
                                        <div className="text-3xl font-bold text-blue-600">{percentage}%</div>
                                        <div className="text-gray-600 font-semibold">Score</div>
                                    </div>
                                    
                                    <div className="bg-orange-100 rounded-2xl p-6">
                                        <div className="text-4xl mb-2">üî•</div>
                                        <div className="text-3xl font-bold text-orange-600">{bestStreak}</div>
                                        <div className="text-gray-600 font-semibold">Best Streak</div>
                                    </div>
                                </div>
                                
                                <div className="space-y-4">
                                    <button
                                        onClick={() => startGame(selectedMode, selectedTable)}
                                        className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold text-xl rounded-xl transition-all transform hover:scale-105"
                                    >
                                        üîÑ Play Again
                                    </button>
                                    
                                    <button
                                        onClick={() => setGameMode('menu')}
                                        className="w-full py-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold text-xl rounded-xl transition-all"
                                    >
                                        üè† Back to Menu
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        ReactDOM.render(<MultiplicationQuiz />, document.getElementById('root'));
    </script>
</body>
</html>